---
layout: default_post
pagination:
  enabled: true
---

{% assign words = content | number_of_words %}
{% assign reading_time = words | divided_by: 200 %}
{% if reading_time == 0 %}
  {% assign reading_time = 1 %}
{% endif %}

<!-- Reading Progress Bar -->
<div class="reading-progress-bar" id="reading-progress-bar"></div>

<!-- Scroll to Top Button -->
<button id="scroll-to-top" class="scroll-to-top" aria-label="Scroll to top">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="18 15 12 9 6 15"></polyline>
  </svg>
</button>

<div class="post-with-toc">
  <!-- Table of Contents Sidebar (only for posts > 5 min) -->
  {% if reading_time > 5 %}
  <aside class="toc-sidebar" id="toc-sidebar">
    <div class="toc-container">
      <h3 class="toc-title" id="toc-title">
        <span>üìë Contents</span>
        <span class="toc-toggle" id="toc-toggle">‚ñº</span>
      </h3>
      <nav id="toc-nav"></nav>
    </div>
  </aside>
  {% endif %}

  <div class="post">
    <header class="post-header">
      <h1>{{ page.title }}</h1>
      <div class="post-meta">
        <div class="post-date">
          üìÖ {{ page.date | date: '%Y-%m-%d' }}
        </div>
        <div class="post-reading-time">
          üïê {{ reading_time }} min read
        </div>
        <div class="post-tags">
          üè∑Ô∏è {% for tag in page.tags %}<span><a href="/tag/{{ tag }}"><code class="highligher"><nobr>{{ tag }}</nobr></code></a></span>{% endfor %}
        </div>
      </div>
    </header>

    <article class="post-content">
    {{ content }}
    </article>
  </div>
</div>

<div style="margin: 30px 0 10px 0; text-align: center;">
<b>tagged in</b>: [
{% for tag in page.tags %}
  {% capture tag_name %}{{ tag }}{% endcapture %}
  <a href="/tag/{{ tag_name }}"><code class="highligher-rouge"><nobr>{{ tag_name }}</nobr></code></a>
{% endfor %}
]
</div>

{% include share-page.html %}

{% include cc-license.html %}

{% if page.comments %}
  {% include comments.html %}
{% endif %}

<!-- Next/Previous Post Navigation -->
<nav class="post-navigation">
  <div class="nav-links">
    {% if page.previous.url %}
    <a class="nav-previous" href="{{ page.previous.url }}">
      <span class="nav-arrow">‚Üê</span>
      <div class="nav-content">
        <span class="nav-label">Previous</span>
        <span class="nav-title">{{ page.previous.title }}</span>
      </div>
    </a>
    {% else %}
    <span class="nav-previous nav-disabled"></span>
    {% endif %}

    {% if page.next.url %}
    <a class="nav-next" href="{{ page.next.url }}">
      <div class="nav-content">
        <span class="nav-label">Next</span>
        <span class="nav-title">{{ page.next.title }}</span>
      </div>
      <span class="nav-arrow">‚Üí</span>
    </a>
    {% else %}
    <span class="nav-next nav-disabled"></span>
    {% endif %}
  </div>
</nav>

<!-- Table of Contents: CSS Styles -->
<style>
  /* Main container for post with TOC */
  .post-with-toc {
    display: flex;
    position: relative;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 15px;
  }

  /* Sidebar styling */
  .toc-sidebar {
    position: sticky;
    top: 80px;
    left: 0;
    width: 220px;
    height: fit-content;
    padding-right: 20px;
    flex-shrink: 0;
  }

  .toc-container {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    max-height: calc(100vh - 100px);
    overflow-y: auto;
  }

  .toc-title {
    margin: 0 0 12px 0;
    font-size: 16px;
    font-weight: 600;
    color: #212529;
    border-bottom: 2px solid #dee2e6;
    padding-bottom: 8px;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .toc-toggle {
    display: none;
    font-size: 14px;
    color: #6c757d;
    transition: transform 0.3s ease;
  }

  .toc-toggle.rotated {
    transform: rotate(180deg);
  }

  /* TOC navigation list */
  #toc-nav {
    margin: 0;
    padding: 0;
    list-style: none;
  }

  #toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  #toc-nav li {
    margin: 0;
    padding: 0;
  }

  #toc-nav a {
    display: block;
    padding: 5px 10px;
    color: #495057;
    text-decoration: none;
    font-size: 13px;
    line-height: 1.4;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
    margin: 1px 0;
  }

  #toc-nav a:hover {
    color: #0066cc;
    background: #e9ecef;
    border-left-color: #0066cc;
  }

  /* Active/current section highlighting */
  #toc-nav a.active {
    color: #0066cc;
    font-weight: 600;
    background: #e7f1ff;
    border-left-color: #0066cc;
  }

  /* Nested heading levels (H3, H4, etc.) */
  #toc-nav .toc-h2 { padding-left: 10px; }
  #toc-nav .toc-h3 { padding-left: 22px; font-size: 12px; }
  #toc-nav .toc-h4 { padding-left: 34px; font-size: 11px; }

  /* Main post content */
  .post-with-toc .post {
    flex: 1;
    min-width: 0;
    max-width: 850px;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Responsive: show TOC inline at top on smaller screens */
  @media screen and (max-width: 1200px) {
    .post-with-toc {
      display: block;
      padding: 0 20px;
      overflow-x: hidden;
    }

    .toc-sidebar {
      position: relative;
      top: 0;
      width: 100%;
      padding-right: 0;
      margin-bottom: 30px;
      order: -1;
    }

    .toc-container {
      max-width: 100%;
      margin: 0 auto;
      overflow-x: hidden;
    }

    .toc-title {
      cursor: pointer;
    }

    .toc-title:hover {
      color: #0066cc;
    }

    .toc-toggle {
      display: inline-block;
    }

    #toc-nav {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.4s ease, opacity 0.3s ease;
      opacity: 1;
    }

    #toc-nav.collapsed {
      max-height: 0;
      opacity: 0;
      margin-top: 0;
    }

    .toc-title {
      margin-bottom: 0;
    }

    .toc-title.expanded {
      margin-bottom: 12px;
    }

    .post-with-toc .post {
      max-width: 100%;
      margin: 0 auto;
      padding: 0;
      overflow-x: hidden;
    }

    .post-content {
      overflow-x: hidden;
      word-wrap: break-word;
    }
  }

  /* Custom scrollbar for TOC */
  .toc-container::-webkit-scrollbar {
    width: 6px;
  }

  .toc-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
  }

  .toc-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
  }

  .toc-container::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  /* Reading Progress Bar */
  .reading-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, #0066cc, #0099ff);
    z-index: 9999;
    transition: width 0.1s ease;
  }

  /* Scroll to Top Button */
  .scroll-to-top {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: #333333;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 1000;
  }

  .scroll-to-top.visible {
    opacity: 1;
    visibility: visible;
  }

  .scroll-to-top:hover {
    background: #000000;
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
  }

  .scroll-to-top:active {
    transform: translateY(-1px);
  }

  /* Mobile adjustments */
  @media screen and (max-width: 768px) {
    .scroll-to-top {
      bottom: 20px;
      right: 20px;
      width: 45px;
      height: 45px;
    }
  }

  /* Copy Code Button */
  .code-block-wrapper {
    position: relative;
  }

  .copy-code-button {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 6px 12px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    color: #495057;
    cursor: pointer;
    opacity: 0;
    transition: all 0.2s ease;
    z-index: 10;
  }

  .code-block-wrapper:hover .copy-code-button {
    opacity: 1;
  }

  .copy-code-button:hover {
    background: #e9ecef;
    border-color: #adb5bd;
    color: #212529;
  }

  .copy-code-button:active {
    transform: scale(0.95);
  }

  .copy-code-button.copied {
    background: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
  }

  /* Next/Previous Post Navigation */
  .post-navigation {
    margin: 50px auto 40px;
    max-width: 850px;
    padding: 0 30px;
  }

  .nav-links {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    border-top: 2px solid #e9ecef;
    padding-top: 30px;
  }

  .nav-previous,
  .nav-next {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    flex: 1;
    max-width: 48%;
  }

  .nav-previous {
    justify-content: flex-start;
  }

  .nav-next {
    justify-content: flex-end;
  }

  .nav-previous:hover,
  .nav-next:hover {
    background: #e9ecef;
    border-color: #0066cc;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .nav-arrow {
    font-size: 24px;
    color: #0066cc;
    font-weight: bold;
  }

  .nav-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .nav-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .nav-title {
    font-size: 16px;
    color: #212529;
    font-weight: 500;
    line-height: 1.3;
  }

  .nav-disabled {
    visibility: hidden;
    flex: 1;
    max-width: 48%;
  }

  /* Responsive navigation */
  @media screen and (max-width: 768px) {
    .nav-links {
      flex-direction: column;
      gap: 15px;
    }

    .nav-previous,
    .nav-next {
      max-width: 100%;
    }

    .nav-disabled {
      display: none;
    }
  }
</style>

<!-- Table of Contents: JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tocNav = document.getElementById('toc-nav');

  // Only run if TOC container exists (i.e., post is > 5 min)
  if (!tocNav) return;

  // Mobile TOC toggle functionality
  const tocTitle = document.getElementById('toc-title');
  const tocToggle = document.getElementById('toc-toggle');

  if (tocTitle && tocToggle) {
    // Start collapsed on mobile (screens < 1200px)
    if (window.innerWidth <= 1200) {
      tocNav.classList.add('collapsed');
      tocToggle.classList.add('rotated');
    }

    tocTitle.addEventListener('click', function() {
      // Only toggle on mobile screens
      if (window.innerWidth <= 1200) {
        tocNav.classList.toggle('collapsed');
        tocToggle.classList.toggle('rotated');
        tocTitle.classList.toggle('expanded');
      }
    });

    // Handle window resize
    window.addEventListener('resize', function() {
      if (window.innerWidth > 1200) {
        // Remove collapsed state on larger screens
        tocNav.classList.remove('collapsed');
        tocToggle.classList.remove('rotated');
        tocTitle.classList.remove('expanded');
      } else if (window.innerWidth <= 1200 && !tocNav.classList.contains('collapsed') && !tocNav.classList.contains('expanded')) {
        // Start collapsed on mobile if not already interacted with
        tocNav.classList.add('collapsed');
        tocToggle.classList.add('rotated');
      }
    });
  }

  // Get all headings from the post content
  const postContent = document.querySelector('.post-content');
  const headings = postContent.querySelectorAll('h2, h3, h4');

  if (headings.length === 0) {
    // No headings found, hide the TOC
    const tocSidebar = document.getElementById('toc-sidebar');
    if (tocSidebar) tocSidebar.style.display = 'none';
    return;
  }

  // Generate TOC from headings
  const tocList = document.createElement('ul');

  headings.forEach((heading, index) => {
    // Add ID to heading if it doesn't have one
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    const listItem = document.createElement('li');
    const link = document.createElement('a');

    link.textContent = heading.textContent;
    link.href = '#' + heading.id;
    link.className = 'toc-' + heading.tagName.toLowerCase();
    link.setAttribute('data-target', heading.id);

    // Smooth scroll on click
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.getElementById(heading.id);
      if (target) {
        const yOffset = -80; // Offset for fixed header
        const y = target.getBoundingClientRect().top + window.pageYOffset + yOffset;
        window.scrollTo({ top: y, behavior: 'smooth' });

        // Update URL without jumping
        history.pushState(null, null, '#' + heading.id);
      }
    });

    listItem.appendChild(link);
    tocList.appendChild(listItem);
  });

  tocNav.appendChild(tocList);

  // Scroll Spy: Highlight current section
  let observerOptions = {
    root: null,
    rootMargin: '-80px 0px -80% 0px',
    threshold: 0
  };

  let observer = new IntersectionObserver(function(entries) {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = tocNav.querySelector(`a[data-target="${id}"]`);

      if (entry.isIntersecting) {
        // Remove active class from all links
        tocNav.querySelectorAll('a').forEach(link => {
          link.classList.remove('active');
        });
        // Add active class to current link
        if (tocLink) {
          tocLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  // Observe all headings
  headings.forEach(heading => {
    observer.observe(heading);
  });

  // Fallback scroll spy for browsers without IntersectionObserver
  if (!('IntersectionObserver' in window)) {
    window.addEventListener('scroll', function() {
      let scrollPosition = window.scrollY + 100;

      headings.forEach(heading => {
        const headingTop = heading.offsetTop;
        const headingBottom = headingTop + heading.offsetHeight;

        if (scrollPosition >= headingTop && scrollPosition < headingBottom) {
          tocNav.querySelectorAll('a').forEach(link => {
            link.classList.remove('active');
          });

          const tocLink = tocNav.querySelector(`a[data-target="${heading.id}"]`);
          if (tocLink) {
            tocLink.classList.add('active');
          }
        }
      });
    });
  }

  // ============================================
  // Reading Progress Bar
  // ============================================
  const progressBar = document.getElementById('reading-progress-bar');

  function updateProgressBar() {
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollDistance = documentHeight - windowHeight;
    const progress = (scrollTop / scrollDistance) * 100;

    if (progressBar) {
      progressBar.style.width = progress + '%';
    }
  }

  // Update on scroll
  window.addEventListener('scroll', updateProgressBar);
  // Initialize on load
  updateProgressBar();

  // ============================================
  // Scroll to Top Button
  // ============================================
  const scrollToTopBtn = document.getElementById('scroll-to-top');

  // Show/hide button based on scroll position
  function toggleScrollToTopButton() {
    if (window.pageYOffset > 300) {
      scrollToTopBtn.classList.add('visible');
    } else {
      scrollToTopBtn.classList.remove('visible');
    }
  }

  // Scroll to top when clicked
  scrollToTopBtn.addEventListener('click', function() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });

  // Listen to scroll events
  window.addEventListener('scroll', toggleScrollToTopButton);
  // Initialize on load
  toggleScrollToTopButton();

  // ============================================
  // Copy Code Button
  // ============================================
  const codeBlocks = document.querySelectorAll('pre');

  codeBlocks.forEach((codeBlock) => {
    // Skip if it's a terminal block or already wrapped
    if (codeBlock.classList.contains('terminal') || codeBlock.parentElement.classList.contains('code-block-wrapper')) {
      return;
    }

    // Create wrapper
    const wrapper = document.createElement('div');
    wrapper.className = 'code-block-wrapper';

    // Wrap the code block
    codeBlock.parentNode.insertBefore(wrapper, codeBlock);
    wrapper.appendChild(codeBlock);

    // Create copy button
    const copyButton = document.createElement('button');
    copyButton.className = 'copy-code-button';
    copyButton.textContent = 'Copy';
    copyButton.setAttribute('aria-label', 'Copy code to clipboard');

    // Add click handler
    copyButton.addEventListener('click', async () => {
      const code = codeBlock.querySelector('code');
      const text = code ? code.textContent : codeBlock.textContent;

      try {
        await navigator.clipboard.writeText(text);

        // Visual feedback
        copyButton.textContent = 'Copied!';
        copyButton.classList.add('copied');

        // Reset after 2 seconds
        setTimeout(() => {
          copyButton.textContent = 'Copy';
          copyButton.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
        copyButton.textContent = 'Failed';

        setTimeout(() => {
          copyButton.textContent = 'Copy';
        }, 2000);
      }
    });

    // Add button to wrapper
    wrapper.appendChild(copyButton);
  });
});
</script>
